<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sportwave — Live VRFS Streams</title>
  <meta name="description" content="Sportwave — Live VRFS streams, fixtures, and match viewer" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#FC2E20;
      --secondary:#FDB750;
      --white:#FFFFFF;
      --bg-dark:#0a0a0a;
      --card-bg:#121212;
      --accent:linear-gradient(135deg,var(--primary),var(--secondary));
      font-family:'Montserrat',system-ui;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg-dark);color:var(--white);min-height:100vh;overflow-x:hidden}
    header{
      display:flex;justify-content:space-between;align-items:center;
      padding:20px 36px;background:rgba(255,255,255,0.05);
      backdrop-filter:blur(8px);position:sticky;top:0;z-index:50
    }
    .brand{display:flex;align-items:center;gap:14px}
    .logo{
      width:60px;height:60px;border-radius:14px;
      background:var(--accent);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:22px;box-shadow:0 0 20px rgba(252,46,32,0.4)
    }
    .title h1{margin:0;font-size:20px}
    .title p{margin:0;font-size:12px;opacity:.8}
    .hero{
      padding:60px 20px;text-align:center;
      background:radial-gradient(circle at 50% 10%,rgba(252,46,32,0.3),transparent 60%);
      margin-bottom:24px;
    }
    .hero h2{font-size:36px;font-weight:700;margin-bottom:8px}
    .hero p{opacity:.85}
    .controls{
      display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:30px 0 10px
    }
    .controls input,.controls select,.controls button{
      padding:12px 16px;border-radius:10px;border:0;color:#fff;
      background:rgba(255,255,255,0.08);
      transition:all .2s ease;
    }
    .controls button:hover{background:var(--accent);cursor:pointer}
    .section-title{margin:10px 0 10px 36px;font-size:18px;font-weight:700}
    /* Netflix-style carousel */
    .carousel{display:flex;overflow-x:auto;scroll-behavior:smooth;gap:18px;padding:10px 36px}
    .carousel::-webkit-scrollbar{display:none}
    .card{
      background:var(--card-bg);border-radius:14px;flex:0 0 220px;
      cursor:pointer;transition:transform .25s,box-shadow .25s;
      box-shadow:0 4px 20px rgba(0,0,0,.4);overflow:hidden;position:relative
    }
    .card:hover{transform:scale(1.1);box-shadow:0 8px 30px rgba(0,0,0,.7);z-index:3}
    .thumb img{width:100%;height:130px;object-fit:cover;display:block}
    .card-info{padding:12px}
    .card-info h3{margin:0;font-size:15px;font-weight:600}
    .card-info p{margin:6px 0 0;font-size:12px;color:rgba(255,255,255,0.7)}
    /* Expanded view (modal) */
    .expanded{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.8);backdrop-filter:blur(12px);
      z-index:999;display:flex;align-items:center;justify-content:center;
      animation:fadeIn .3s ease-in-out
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .expanded-content{
      max-width:900px;width:90%;background:rgba(18,18,18,0.95);
      border-radius:14px;box-shadow:0 8px 40px rgba(0,0,0,0.6);
      padding:24px;position:relative;overflow:hidden
    }
    .expanded .close{
      position:absolute;top:12px;right:16px;background:rgba(255,255,255,0.1);
      border:0;color:#fff;border-radius:50%;width:36px;height:36px;
      font-size:18px;cursor:pointer;transition:background .2s
    }
    .expanded .close:hover{background:rgba(255,255,255,0.25)}
    .expanded h2{margin-top:0;font-size:22px;font-weight:700}
    .ai-desc{
      margin:10px 0 16px;font-size:14px;
      color:rgba(255,255,255,0.85);line-height:1.6
    }
    .player{
      position:relative;padding-top:56.25%;
      border-radius:12px;overflow:hidden;background:#000;margin-bottom:16px
    }
    .player iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    .match-details{font-size:14px;opacity:0.85;margin-top:6px}
    .chat-toggle{
      display:inline-block;margin-top:12px;padding:8px 14px;
      border-radius:8px;background:var(--accent);color:#fff;
      font-weight:600;cursor:pointer;font-size:13px;border:none;font-family:inherit
    }
    .chat-frame{
      margin-top:14px;border-radius:10px;overflow:hidden;
      height:400px;display:none
    }
    footer{
      text-align:center;color:rgba(255,255,255,0.6);
      padding:40px 0;margin-top:40px
    }
    @media(max-width:700px){
      .hero h2{font-size:26px}
      .card{flex:0 0 160px}
      .thumb img{height:100px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">SW</div>
      <div class="title">
        <h1>Sportwave — Live Streams</h1>
        <p>VRFS • Fixtures • Match Viewer</p>
      </div>
    </div>
    <div style="text-align:right"><strong>Sportwave</strong><br><small>Community stream hub</small></div>
  </header>

  <section class="hero">
    <h2>Catch Every Match Live</h2>
    <p>Scroll through fixtures and click a match to stream instantly.</p>
  </section>

  <div class="controls">
    <input id="search" placeholder="Search teams or competition" />
    <select id="filterDate"><option value="all">All dates</option></select>
    <button id="refresh">Refresh</button>
  </div>

  <h3 class="section-title">Live VRFS Fixtures</h3>
  <div class="carousel" id="cards"></div>

  <footer>Sportwave • Live VRFS Streams</footer>

  <script>
    const SHEET_KEY='2PACX-1vRxBCDipb1G3U7YmglB01b35zs6sHFspQhE2FYHzaUctuqvdZVMbNZTAY3kYoguMOZaKUsVhSly1K-J';
    const cardsEl=document.getElementById('cards');
    const searchEl=document.getElementById('search');
    const filterDateEl=document.getElementById('filterDate');
    const refreshBtn=document.getElementById('refresh');

    async function loadSheet(){
      cardsEl.innerHTML='<div style="color:#fff;opacity:.7;text-align:center;width:100%">Loading fixtures...</div>';
      try{
        const res=await fetch(`https://docs.google.com/spreadsheets/d/e/${SHEET_KEY}/pub?output=csv`);
        const text=await res.text();
        const rows=text.split(/\r?\n/).map(r=>r.split(','));
        const headers=rows.shift();
        const data=rows.map(r=>Object.fromEntries(r.map((c,i)=>[headers[i],c])));
        window.SportwaveFixtures=data.map(r=>({
          date:r['Date']||'',
          time:r['Time']||'',
          match:r['Match']||'',
          teams:r['Teams']||'',
          link:r['Stream Link']||'',
          thumb:r['Thumbnail']||''
        }));
        populateDateFilter(window.SportwaveFixtures);
        renderFixtures(window.SportwaveFixtures);
      }catch(err){
        cardsEl.innerHTML='<div style="color:#f99">Error loading fixtures.</div>';
      }
    }

    function populateDateFilter(fixtures){
      const dates=[...new Set(fixtures.map(f=>f.date))].filter(Boolean);
      filterDateEl.innerHTML='<option value="all">All dates</option>'+dates.map(d=>`<option value="${d}">${d}</option>`).join('');
    }

    function renderFixtures(fixtures){
      const q=searchEl.value.trim().toLowerCase();
      const dateFilter=filterDateEl.value;
      const filtered=fixtures.filter(f=>{
        if(dateFilter!=='all'&&f.date!==dateFilter)return false;
        if(!q)return true;
        return(f.teams+' '+f.match).toLowerCase().includes(q);
      });
      if(filtered.length===0){cardsEl.innerHTML='<div style="opacity:.8">No fixtures found.</div>';return;}
      cardsEl.innerHTML=filtered.map((f,i)=>`
        <div class="card" data-index="${i}">
          <div class="thumb">${f.thumb?`<img src="${f.thumb}" alt="">`:'<div style="height:130px;background:#333"></div>'}</div>
          <div class="card-info">
            <h3>${escapeHtml(f.teams)}</h3>
            <p>${escapeHtml(f.date)} • ${escapeHtml(f.time)}</p>
          </div>
        </div>
      `).join('');
      document.querySelectorAll('.card').forEach(c=>c.addEventListener('click',()=>openExpanded(c.dataset.index)));
    }

    function openExpanded(index){
      const f=window.SportwaveFixtures[index];
      const aiDescription=generateAIDescription(f);
      const expanded=document.createElement('div');
      expanded.className='expanded';
      expanded.innerHTML=`
        <div class="expanded-content">
          <button class="close">×</button>
          <h2>${escapeHtml(f.teams)}</h2>
          <p class="ai-desc">${aiDescription}</p>
          <div class="player">
            ${f.link?`<iframe src="${getEmbedUrl(f.link)}" allowfullscreen sandbox="allow-same-origin allow-scripts allow-popups"></iframe>`:'<div style="text-align:center;padding:30px;color:#fff">No stream link</div>'}
          </div>
          <div class="match-details">${escapeHtml(f.match)} • ${escapeHtml(f.date)} • ${escapeHtml(f.time)}</div>
          ${isTwitchUrl(f.link)?'<button class="chat-toggle" id="toggleChat">Show Chat</button><div class="chat-frame" id="chatFrame"><iframe src="'+getTwitchChatUrl(getTwitchChannel(f.link))+'" width="100%" height="100%"></iframe></div>':''}
        </div>
      `;
      document.body.appendChild(expanded);
      expanded.querySelector('.close').onclick=()=>expanded.remove();
      const toggleChat=expanded.querySelector('#toggleChat');
      if(toggleChat){
        toggleChat.onclick=()=>{
          const frame=expanded.querySelector('#chatFrame');
          const visible=frame.style.display==='block';
          frame.style.display=visible?'none':'block';
          toggleChat.textContent=visible?'Show Chat':'Hide Chat';
        };
      }
    }

    // AI Description logic
    function generateAIDescription(fixture){
      const teams=fixture.teams||'Two teams';
      const matchName=fixture.match||'a thrilling fixture';
      const date=fixture.date||'an upcoming day';
      const parts=teams.split(' vs ');
      const teamA=parts[0]||'Team A';
      const teamB=parts[1]||'Team B';
      const templates=[
        `${teamA} face off against ${teamB} in ${matchName}, a matchup expected to deliver intensity, skill, and pure VRFS drama.`,
        `A gripping showdown between ${teamA} and ${teamB}. With both sides in fine form, this ${matchName} could define their ${date} campaign.`,
        `${matchName} brings together ${teamA} and ${teamB} — expect high pace, bold tactics, and a crowd on edge.`,
        `Under the virtual floodlights, ${teamA} take on ${teamB} in what promises to be one of the most exciting matches of ${date}.`,
        `All eyes on ${teamA} vs ${teamB}. Expect goals, tension, and top-tier VRFS action in ${matchName}.`
      ];
      return templates[Math.floor(Math.random()*templates.length)];
    }

    function getEmbedUrl(link){
      if(isTwitchUrl(link)){
        const c=getTwitchChannel(link);
        return `https://player.twitch.tv/?channel=${c}&parent=${window.location.hostname}&autoplay=true`;
      }
      return link;
    }
    function isTwitchUrl(url){return url&&url.includes('twitch.tv')}
    function getTwitchChannel(url){const m=url.match(/(?:www\.|go\.)?twitch\.tv\/([^\/]+)/);return m&&m[1]?m[1]:null}
    function getTwitchChatUrl(channel){return `https://www.twitch.tv/embed/${channel}/chat?parent=${window.location.hostname}&darkpopout`}
    function escapeHtml(s){return s?String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m])):''}

    searchEl.addEventListener('input',()=>renderFixtures(window.SportwaveFixtures||[]));
    filterDateEl.addEventListener('change',()=>renderFixtures(window.SportwaveFixtures||[]));
    refreshBtn.addEventListener('click',loadSheet);
    loadSheet();
  </script>
</body>
</html>
